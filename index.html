<script>
const data={
  logos:['images/logos/logo1.jpg','images/logos/logo2.jpg','images/logos/logo3.jpg','images/logos/logo4.jpg','images/logos/logo5.jpg','images/logos/logo6.jpg','images/logos/logo7.jpg','images/logos/logo8.jpg','images/logos/logo9.jpg'],
  affiches:['images/affiches/affiche1.jpg','images/affiches/affiche2.jpg','images/affiches/affiche3.jpg','images/affiches/affiche4.jpg','images/affiches/affiche5.jpg','images/affiches/affiche6.jpg','images/affiches/affiche7.jpg','images/affiches/affiche8.jpg'],
  flyers:['images/flyers/flyers1.jpg','images/flyers/flyers2.jpg'],
  mockups:['images/mockups/mockup1.jpg','images/mockups/mockup2.jpg'],
  cd:['images/cd/cd1.jpg','images/cd/cd2.jpg']
};

let sliders={}, fullIndex={};

function initSliders(){
  for(const cat in data){
    const slidesDiv=document.querySelector(`#slider-${cat} .slides`);
    sliders[cat]={index:0, slidesDiv};
    fullIndex[cat]=[];

    data[cat].forEach((src,i)=>{
      const img=document.createElement('img');
      img.src=src;
      img.alt=`${cat} image ${i+1}`;
      img.onclick=()=>openLightbox(src);
      slidesDiv.appendChild(img);
    });

    slidesDiv.parentElement.querySelector('.arrow.left').onclick = ()=>moveSlide(cat,-1);
    slidesDiv.parentElement.querySelector('.arrow.right').onclick = ()=>moveSlide(cat,1);

    let startX=0;
    slidesDiv.addEventListener('touchstart',e=>startX=e.touches[0].clientX);
    slidesDiv.addEventListener('touchend',e=>{
      const endX=e.changedTouches[0].clientX;
      if(endX-startX>50) moveSlide(cat,-1);
      if(startX-endX>50) moveSlide(cat,1);
    });

    updateSlider(cat);

    if(cat==='logos'||cat==='affiches') animateSlider(cat);
  }

  document.addEventListener('keydown', e=>{
    if(e.key==='ArrowLeft') for(const cat in sliders) moveSlide(cat,-1);
    if(e.key==='ArrowRight') for(const cat in sliders) moveSlide(cat,1);
  });
}

function updateSlider(cat){
  const {slidesDiv,index}=sliders[cat];
  const imgs=slidesDiv.querySelectorAll('img');
  const total=imgs.length;
  const sliderWidth=slidesDiv.clientWidth;

  imgs.forEach((img,i)=>{
    let diff=i-index;
    if(diff<-Math.floor(total/2)) diff+=total;
    if(diff>Math.floor(total/2)) diff-=total;

    const absDiff=Math.abs(diff);

    // ðŸ”¹ ESPACEMENT AUGMENTÃ‰ pour Ã©viter chevauchement
    const baseOffset = sliderWidth / 5;   // espace de base plus grand
    const extraGap = absDiff * 30;        // espacement supplÃ©mentaire selon distance
    const offset = diff * baseOffset + (diff>0?extraGap:-extraGap);

    const rotateY = diff * 25;
    const translateZ = (diff===0)?0:-absDiff*120;
    const scale = 1 - absDiff*0.2;
    const opacity = 1 - absDiff*0.3;

    img.classList.toggle('active', diff===0);
    img.style.zIndex = (diff===0)?total+10:total-absDiff;
    img.style.opacity = opacity;
    img.style.transform = `translateX(${offset}px) translate(-50%, -50%) translateZ(${translateZ}px) scale(${scale}) rotateY(${rotateY}deg)`;
    img.style.filter = absDiff>=2?'blur(4px)':'none';
  });

  // fullIndex complet
  fullIndex[cat] = Array.from(imgs).map((_,i)=>i-index);
  console.log('Index complet :', fullIndex);
}

function moveSlide(cat,step){
  sliders[cat].index=(sliders[cat].index+step+data[cat].length)%data[cat].length;
  updateSlider(cat);
}

function animateSlider(cat){ setInterval(()=>moveSlide(cat,1),5000); }

function openLightbox(src){
  const lightbox=document.getElementById('lightbox');
  lightbox.querySelector('img').src=src;
  lightbox.classList.add('show');
}

function closeLightbox(){
  const lightbox=document.getElementById('lightbox');
  lightbox.classList.remove('show');
  setTimeout(()=>lightbox.style.display='none',400);
}

initSliders();
</script>
